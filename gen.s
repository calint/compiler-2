; generated by baz

true equ 1
false equ 0

section .data
align 4
;[1:1] field hello = "hello world from baz\n" 
hello: db 'hello world from baz',10,''
hello.len equ $-hello
;[2:1] field input = "............................................................" 
input: db '............................................................'
input.len equ $-input
;[3:1] field prompt1 = "enter name: " 
prompt1: db 'enter name: '
prompt1.len equ $-prompt1
;[4:1] field prompt2 = "that is not a name.\n" 
prompt2: db 'that is not a name.',10,''
prompt2.len equ $-prompt2
;[5:1] field prompt3 = "hello " 
prompt3: db 'hello '
prompt3.len equ $-prompt3
;[6:1] field nl = "\n" 
nl: db '',10,''
nl.len equ $-nl
;[7:1] field dot = "." 
dot: db '.'
dot.len equ $-dot

section .bss
align 4
stk resd 1024
stk.end:

section .text
align 4
bits 64
global _start
_start:
mov rsp,stk.end
mov rbp,rsp
jmp main

main:
;  v: qword[rbp-12]
;  [35:5] var v : vector = 3 
;  [35:9] v : vector = 3 
;  [35:22] 3 
;  [35:22] 3 
;  [35:22] v=3 
   mov qword[rbp-12], 3
;  [36:5] v.y = 4 
;  [36:11] 4 
;  [36:11] 4 
;  [36:11] v.y=4 
   mov dword[rbp-4], 4
;  [37:5] print(hello.len, hello) 
;  print(len : reg_rdx, ptr : reg_rsi) 
;    inline: 37_5
;    alloc rdx
;    alias len -> rdx
     mov rdx, hello.len
;    alloc rsi
;    alias ptr -> rsi
     mov rsi, hello
;    [16:5] mov(rax, 1) 
     mov rax, 1
;    [16:19] # write system call 
;    [17:5] mov(rdi, 1) 
     mov rdi, 1
;    [17:19] # file descriptor for standard out 
;    [18:5] mov(rsi, ptr) 
;    [18:19] # buffer address 
;    [19:5] mov(rdx, len) 
;    [19:19] # buffer size 
;    [20:5] syscall 
     syscall
;    free rsi
;    free rdx
   print_37_5_end:
;  [38:5] loop
   loop_38_5:
;    [39:9] print(prompt1.len, prompt1) 
;    print(len : reg_rdx, ptr : reg_rsi) 
;      inline: 39_9
;      alloc rdx
;      alias len -> rdx
       mov rdx, prompt1.len
;      alloc rsi
;      alias ptr -> rsi
       mov rsi, prompt1
;      [16:5] mov(rax, 1) 
       mov rax, 1
;      [16:19] # write system call 
;      [17:5] mov(rdi, 1) 
       mov rdi, 1
;      [17:19] # file descriptor for standard out 
;      [18:5] mov(rsi, ptr) 
;      [18:19] # buffer address 
;      [19:5] mov(rdx, len) 
;      [19:19] # buffer size 
;      [20:5] syscall 
       syscall
;      free rsi
;      free rdx
     print_39_9_end:
;    len: qword[rbp-20]
;    [40:9] var len = read(input.len, input) - 1 
;    [40:13] len = read(input.len, input) - 1 
;    [40:19] read(input.len, input) - 1 
;    [40:19] read(input.len, input) - 1 
;    [40:19] len=read(input.len, input) 
;    [40:19] read(input.len, input) 
;    read(len : reg_rdx, ptr : reg_rsi) : nbytes_read 
;      inline: 40_19
;      alias nbytes_read -> len
;      alloc rdx
;      alias len -> rdx
       mov rdx, input.len
;      alloc rsi
;      alias ptr -> rsi
       mov rsi, input
;      [24:2] mov(rax, 0) 
       mov rax, 0
;      [24:17] # read system call 
;      [25:2] mov(rdi, 0) 
       mov rdi, 0
;      [25:17] # file descriptor for standard input 
;      [26:2] mov(rsi, ptr) 
;      [26:17] # buffer address 
;      [27:2] mov(rdx, len) 
;      [27:17] # buffer size 
;      [28:2] syscall 
       syscall
;      [29:5] mov(nbytes_read, rax) 
       mov qword[rbp-20], rax
;      [29:27] # return value 
;      free rsi
;      free rdx
     read_40_19_end:
;    [40:44] len- 1 
     sub qword[rbp-20], 1
;    [40:49] # -1 don't include the '\n' 
     if_41_12:
;    [41:12] ? len == 0 
;    [41:12] ? len == 0 
     cmp_41_12:
     cmp qword[rbp-20], 0
     jne if_41_9_end
     if_41_12_code:  ; opt1
;      [42:13] break 
       jmp loop_38_5_end
     if_41_9_end:
     if_44_12:
;    [44:12] ? len <= v.x 
;    [44:12] ? len <= v.x 
     cmp_44_12:
;    alloc r15
     mov r15, qword[rbp-12]
     cmp qword[rbp-20], r15
;    free r15
     jg if_44_9_end
     if_44_12_code:  ; opt1
;      [45:13] print(prompt2.len, prompt2) 
;      print(len : reg_rdx, ptr : reg_rsi) 
;        inline: 45_13
;        alloc rdx
;        alias len -> rdx
         mov rdx, prompt2.len
;        alloc rsi
;        alias ptr -> rsi
         mov rsi, prompt2
;        [16:5] mov(rax, 1) 
         mov rax, 1
;        [16:19] # write system call 
;        [17:5] mov(rdi, 1) 
         mov rdi, 1
;        [17:19] # file descriptor for standard out 
;        [18:5] mov(rsi, ptr) 
;        [18:19] # buffer address 
;        [19:5] mov(rdx, len) 
;        [19:19] # buffer size 
;        [20:5] syscall 
         syscall
;        free rsi
;        free rdx
       print_45_13_end:
;      [46:13] continue 
       jmp loop_38_5
     if_44_9_end:
;    [48:9] print(prompt3.len, prompt3) 
;    print(len : reg_rdx, ptr : reg_rsi) 
;      inline: 48_9
;      alloc rdx
;      alias len -> rdx
       mov rdx, prompt3.len
;      alloc rsi
;      alias ptr -> rsi
       mov rsi, prompt3
;      [16:5] mov(rax, 1) 
       mov rax, 1
;      [16:19] # write system call 
;      [17:5] mov(rdi, 1) 
       mov rdi, 1
;      [17:19] # file descriptor for standard out 
;      [18:5] mov(rsi, ptr) 
;      [18:19] # buffer address 
;      [19:5] mov(rdx, len) 
;      [19:19] # buffer size 
;      [20:5] syscall 
       syscall
;      free rsi
;      free rdx
     print_48_9_end:
;    [49:9] print(len, input) 
;    print(len : reg_rdx, ptr : reg_rsi) 
;      inline: 49_9
;      alloc rdx
;      alias len -> rdx
       mov rdx, qword[rbp-20]
;      alloc rsi
;      alias ptr -> rsi
       mov rsi, input
;      [16:5] mov(rax, 1) 
       mov rax, 1
;      [16:19] # write system call 
;      [17:5] mov(rdi, 1) 
       mov rdi, 1
;      [17:19] # file descriptor for standard out 
;      [18:5] mov(rsi, ptr) 
;      [18:19] # buffer address 
;      [19:5] mov(rdx, len) 
;      [19:19] # buffer size 
;      [20:5] syscall 
       syscall
;      free rsi
;      free rdx
     print_49_9_end:
;    [50:9] print(dot.len, dot) 
;    print(len : reg_rdx, ptr : reg_rsi) 
;      inline: 50_9
;      alloc rdx
;      alias len -> rdx
       mov rdx, dot.len
;      alloc rsi
;      alias ptr -> rsi
       mov rsi, dot
;      [16:5] mov(rax, 1) 
       mov rax, 1
;      [16:19] # write system call 
;      [17:5] mov(rdi, 1) 
       mov rdi, 1
;      [17:19] # file descriptor for standard out 
;      [18:5] mov(rsi, ptr) 
;      [18:19] # buffer address 
;      [19:5] mov(rdx, len) 
;      [19:19] # buffer size 
;      [20:5] syscall 
       syscall
;      free rsi
;      free rdx
     print_50_9_end:
;    [51:9] print(nl.len, nl) 
;    print(len : reg_rdx, ptr : reg_rsi) 
;      inline: 51_9
;      alloc rdx
;      alias len -> rdx
       mov rdx, nl.len
;      alloc rsi
;      alias ptr -> rsi
       mov rsi, nl
;      [16:5] mov(rax, 1) 
       mov rax, 1
;      [16:19] # write system call 
;      [17:5] mov(rdi, 1) 
       mov rdi, 1
;      [17:19] # file descriptor for standard out 
;      [18:5] mov(rsi, ptr) 
;      [18:19] # buffer address 
;      [19:5] mov(rdx, len) 
;      [19:19] # buffer size 
;      [20:5] syscall 
       syscall
;      free rsi
;      free rdx
     print_51_9_end:
   jmp loop_38_5
   loop_38_5_end:
;  [53:5] exit(0) 
;  exit(v : reg_rdi) 
;    inline: 53_5
;    alloc rdi
;    alias v -> rdi
     mov rdi, 0
;    [10:5] mov(rax, 60) 
     mov rax, 60
;    [10:18] # exit system call 
;    [11:5] mov(rdi, v) 
;    [11:18] # return code 
;    [12:5] syscall 
     syscall
;    free rdi
   exit_53_5_end:

; max scratch registers in use: 1
;            max frames in use: 7
