func exit(v : reg_rdi) {
    mov(rax, 60)  # exit system call
    mov(rdi, v)   # return code
    syscall()
}

func assert(expr : bool) {
    if not expr exit(1)
}

func inv(i) : i32 res {
    res = ~i
}

func main() {
    var arr : i32[4]

    arr[1] = ~2
    arr[2] = ~arr[1]

    assert(arr[1] == ~2)
    assert(arr[2] == 2)

    var ix = 3
    arr[ix] = ~arr[ix - 1]
    assert(arr[ix] == ~2)
    
    arr[ix-2] = inv(arr[ix])
    assert(arr[ix-2] == 2)
}
