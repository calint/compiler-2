func exit(v : reg_rdi) {
    mov(rax, 60)  # exit system call
    mov(rdi, v)   # return code
    syscall()
}

func assert(expr : bool) {
    if not expr exit(1)
}

type link {
    name : i8[64],
    name_len : i8,
    loc : i32
}

type location {
    name : i8[64],
    links : link[8]
}

# size: 4320
type world {
    time : i64,
    locations : location[7]
}

func foo(lnk : link){
    lnk.loc = 2
    lnk.name_len = 1
    lnk.name[0] = 0x61 # 'a'
}

func bar(locs : location[]) {
    foo(locs[2].links[1])
}

func main() {
   var worlds : world[2]
   var i = 1
   bar(worlds[i].locations)
}

